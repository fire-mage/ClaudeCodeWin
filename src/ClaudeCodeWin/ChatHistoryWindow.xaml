<Window x:Class="ClaudeCodeWin.ChatHistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Chat History"
        Width="650" Height="500"
        MinWidth="400" MinHeight="300"
        WindowStartupLocation="CenterOwner"
        Background="{StaticResource BackgroundBrush}">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="Chat History" FontSize="18" FontWeight="Bold"
                   Foreground="{StaticResource PrimaryBrush}" Margin="0,0,0,12"/>

        <ListView Grid.Row="1" x:Name="HistoryList"
                  Background="{StaticResource SurfaceBrush}"
                  BorderBrush="{StaticResource BorderBrush}"
                  BorderThickness="1"
                  Foreground="{StaticResource TextBrush}"
                  ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                    <Setter Property="Padding" Value="8,6"/>
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ListViewItem">
                                <Border x:Name="Bd" Background="Transparent"
                                        Padding="{TemplateBinding Padding}"
                                        BorderBrush="{StaticResource BorderBrush}"
                                        BorderThickness="0,0,0,1">
                                    <ContentPresenter/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Bd" Property="Background"
                                                Value="{StaticResource MenuHighlightBrush}"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="Bd" Property="Background"
                                                Value="{StaticResource SurfaceLightBrush}"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ListView.ItemContainerStyle>
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0"
                                   Text="{Binding Title}"
                                   FontSize="13" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextBrush}"
                                   TextTrimming="CharacterEllipsis"/>

                        <TextBlock Grid.Row="0" Grid.Column="1"
                                   Text="{Binding UpdatedAt, StringFormat='{}{0:MMM dd, HH:mm}'}"
                                   FontSize="11"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0"/>

                        <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                    Orientation="Horizontal" Margin="0,2,0,0">
                            <TextBlock Text="{Binding ProjectPath}"
                                       FontSize="11"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       TextTrimming="CharacterEllipsis"
                                       MaxWidth="400"/>
                            <TextBlock FontSize="11"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="12,0,0,0">
                                <Run Text="{Binding MessageCount, Mode=OneWay}"/>
                                <Run Text="messages"/>
                            </TextBlock>
                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <StackPanel Grid.Row="2" Orientation="Horizontal"
                    HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button Content="Open" x:Name="OpenButton" Click="OpenButton_Click"
                    Style="{StaticResource PrimaryButton}"
                    Padding="24,6" Margin="0,0,8,0"
                    IsEnabled="False"/>
            <Button Content="Delete" x:Name="DeleteButton" Click="DeleteButton_Click"
                    Padding="24,6" Margin="0,0,8,0"
                    IsEnabled="False"
                    Foreground="{StaticResource ErrorBrush}"
                    Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource ErrorBrush}"/>
            <Button Content="Close" Click="CloseButton_Click"
                    Padding="24,6"
                    Background="{StaticResource SurfaceBrush}"
                    Foreground="{StaticResource TextBrush}"
                    BorderBrush="{StaticResource BorderBrush}"/>
        </StackPanel>
    </Grid>
</Window>
